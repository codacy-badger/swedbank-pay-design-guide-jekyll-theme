{% comment %}
Original creator: https://sebnitu.com/2016/10/13/dynamic-menus-in-jekyll/
{% endcomment %}
<nav class="documentation-nav">
    {% assign pages = site.pages | sort: 'menu-order' %}
    {% for node in pages %}
        {% assign has_node_hide_from_sidebar = node | has_key: 'hide_from_sidebar' %}
        {% assign node_parts = node.url | split: '/' %}
        {% assign node_depth = node_parts | size %}

        {% if node_depth == 2 %}
            {% unless has_node_hide_from_sidebar %}
                <div class="nav-group {% if page.url contains node.url %} active {% endif %}">
                    <div class="nav-heading">
                        <i class="material-icons">keyboard_arrow_right</i>
                        <a {% if page.url contains node.url %} aria-current="page" class="active" {% endif %} href="{{ node.url }}">
                            {{ node.title }}
                        </a>
                    </div>

                    {% assign node_root = '/' | append: node_parts[1] | append: '/' %}
                    {% assign has_children = false %}
                    {% for subnode in pages %}
                        {% if subnode.url contains node_root and subnode.url != node_root %}
                            {% assign has_children = true %}
                        {% endif %}
                    {% endfor %}

                    {% if has_children == true %}
                        <ul>
                            {% for subnode in pages %}
                                {% if subnode.url contains node_root and subnode.url != node_root %}
                                    {% assign node_parts = subnode.url | split: '/' %}
                                    {% assign node_depth = node_parts | size %}

                                    {% if node_depth == 3 and subnode.hide_from_sidebar == nil %}
                                        <li>
                                            <a {% if page.url contains subnode.url %} aria-current="page" class="active" {% endif %} href="{{ subnode.url }}">
                                                {{ subnode.title }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            {% endunless %}
        {% endif %}
    {% endfor %}
</nav>
